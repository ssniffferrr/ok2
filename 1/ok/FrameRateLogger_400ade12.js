define(["OK/logger"],(function(t){"use strict";var e,n=null,i=null,a="nogwt",r=!1,o=5e3,d=30,u=100,s=5,l=[50],m=1e3,c=0,f=0,g=0,v=0,b=0,h=null,p=[],w=!1,y=0;function A(t,e){document.body.dispatchEvent(new CustomEvent("performance-event",{detail:{type:t,value:e},bubbles:!0}))}function O(){return OK&&OK.Layers&&OK.Layers.isAnyLayerOpened()}function k(t){t-f>u&&(v+=1),f=t,t-g>=m?(p.push(b),b=0,g=t):b+=1,t-c>o?L(!0):h=window.requestAnimationFrame(k)}function C(){v=0,y=0,b=0,f=window.performance.now(),c=f,g=f,r=O(),w=!0,h=window.requestAnimationFrame(k)}function E(t,e){var n={};return t.sort((function(t,e){return t-e})),e.forEach((function(e){if(e){var i=Math.floor((t.length-1)*(e/100));n["p"+e]=t[i]}})),n}function L(e){window.cancelAnimationFrame(h),h=null,w=!1;var n=a;if((r||O())&&(n="layer"),e)t.duration&&(v>s&&v<o/u&&(t.duration("framerate",v,n),A("framerate",{lagCount:v,state:n})),y>s&&(t.duration("longtask.duration",y,n),A("longtask",{lagCount:y,state:n}))),C();else{for(var i,c,f,g,b,k=function(t){var e,n,i,a=[],r=1e3/m;for(n=r-1;n<t.length;n++){for(e=0,i=0;i<r;i++)e+=t[n-i];a.push(e)}return a}(p);k.length>=d;){for(i=k.splice(0,d),b=0,f=0;f<d;f++)(g=i[f])>60&&(t.duration("overFpsLimit",g),g=60,i[f]=g),b+=g;(c=E(i,l)).mean=Math.floor(b/d),c.min=Math.min.apply(null,i),c.max=Math.max.apply(null,i),c.state=n,t.duration("altFramerate",c.p50||0,n,JSON.stringify(c)),A("altFramerate",c)}p=[]}}function K(){L(!1),a=OK.getCurrentDesktopModelId(),C()}function M(){document[n]?L(!1):C()}return void 0!==document.hidden?(n="hidden",i="visibilitychange"):void 0!==document.mozHidden?(n="mozHidden",i="mozvisibilitychange"):void 0!==document.msHidden?(n="msHidden",i="msvisibilitychange"):void 0!==document.webkitHidden&&(n="webkitHidden",i="webkitvisibilitychange"),{activate:function(n){if(o=Number(n.getAttribute("data-test-time"))||o,u=Number(n.getAttribute("data-threshold"))||u,s=n.hasAttribute("data-limit")?Number(n.getAttribute("data-limit")):s,d=n.hasAttribute("data-stat-limit")?Number(n.getAttribute("data-stat-limit")):d,m=n.hasAttribute("data-frame-period")?Number(n.getAttribute("data-frame-period")):m,l=n.hasAttribute("data-percentiles")?n.getAttribute("data-percentiles").split(",").map((function(t){return Number(t)})):l,a=OK.getCurrentDesktopModelId&&OK.getCurrentDesktopModelId()||a,"PerformanceObserver"in window)try{e=new PerformanceObserver((function(t){for(var e=t.getEntries(),n=0;w&&n<e.length;n++)y+=1})).observe({entryTypes:["longtask"]})}catch(e){t.success("longtask.error","unsupported")}i&&(window.addEventListener("navigationStateChanged",K),document.addEventListener(i,M,!1)),C()},deactivate:function(){L(!1),e&&e.disconnect(),i&&(window.addEventListener("navigationStateChanged",K),document.removeEventListener(i,M))}}}));
//# sourceMappingURL=/res/source-maps/js/app/FrameRateLogger.js.map